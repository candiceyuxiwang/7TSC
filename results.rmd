---
title: "results"
author: "Candice Wang"
date: "11/23/2019"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

## Read the data from Matlab script output

```{r}
# SC and IC parameter estimates (before adding visual property regressors to the model)
library(R.matlab)
data <- readMat('Analysis4_fullmaskcolliculi_hd_output_newbetas_aug15.mat') # a list of 16 variables
neu_colnum <- 1 # the first column is neutral condition betas
aver_colnum <- 4 # the fourth column is aversive condition betas
leftICneu <- data[[1]][,neu_colnum] # parameter estimates for 11 subjects; left IC neutral
leftICaver <- data[[1]][,aver_colnum]
leftSCneu <- data[[5]][,neu_colnum] # lists 2-4 are some stats that are irrelevant here
leftSCaver <- data[[5]][,aver_colnum]
rightICneu <- data[[9]][,neu_colnum]
rightICaver <- data[[9]][,aver_colnum]
rightSCneu <- data[[13]][,neu_colnum]
rightSCaver <- data[[13]][,aver_colnum]
betas <- c(leftSCneu,leftSCaver,leftICneu,leftICaver,rightSCneu,rightSCaver,rightICneu,rightICaver)
subjects <- c(rep(1:11, times = 8))
laterality <- c(rep('Left', times = 44), rep('Right', times = 44))
stimulus_type <- c(rep('Neutral', times = 11), rep('Aversive', times = 11), rep('Neutral', times = 11), rep('Aversive', times = 11), rep('Neutral', times = 11), rep('Aversive', times = 11), rep('Neutral', times = 11), rep('Aversive', times = 11))
superior_inferior <- c(rep('SC', times = 22), rep('IC', times = 22), rep('SC', times = 22), rep('IC', times = 22))
fullmaskdata <- data.frame(subjects, betas, laterality, stimulus_type, superior_inferior)
```

## 2 x 2 x 2 ANOVA with superior/inferior colliculi, left/right laterality, and neutral/aversive image

```{r}
#fullmaskdata$subjects <- as.factor(fullmaskdata$subjects)
#mod <- with(fullmaskdata, aov(fullmaskdata$betas ~ laterality * stimulus_type * superior_inferior + Error(subjects / (laterality * stimulus_type * superior_inferior))))
#ANOVA <- summary(mod)
#ANOVA

# easier to read output using afex package
library(afex)
aov_ez(id = 'subjects', dv = 'betas', data = fullmaskdata, within = c('laterality','stimulus_type','superior_inferior'))

```

Significant main effects of SC/IC, lateral location, and stimulus type (aversive vs. neutral).
Calculate estimated effect size (partial eta squared) for each main effect:
```{r}
# superior vs. inferior colliculi
superior_inferior_sumsq <- ANOVA$`Error: subjects:superior_inferior`[[1]][[2]][1]
superior_inferior_resid_sumsq <- ANOVA$`Error: subjects:superior_inferior`[[1]][[2]][2]
superior_inferior_pes <- superior_inferior_sumsq/(superior_inferior_sumsq + superior_inferior_resid_sumsq)

# left vs. right colliculi 
laterality_sumsq <- ANOVA$`Error: subjects:laterality`[[1]][[2]][1]
laterality_resid_sumsq <- ANOVA$`Error: subjects:laterality`[[1]][[2]][2]
laterality_pes <- laterality_sumsq/(laterality_sumsq + laterality_resid_sumsq)

# aversive vs. neutral stimuli category
stimulus_type_sumsq <- ANOVA$`Error: subjects:stimulus_type`[[1]][[2]][1]
stimulus_type_resid_sumsq <- ANOVA$`Error: subjects:stimulus_type`[[1]][[2]][2]
stimulus_type_pes <- stimulus_type_sumsq/(stimulus_type_sumsq + stimulus_type_resid_sumsq)

sprintf('Estimated effect size (partial eta squared) is %f for superior vs. inferior colliculi main effect, %f for laterality main effect, %f for stimulus category main effect.', superior_inferior_pes, laterality_pes, stimulus_type_pes)
```

Effect size estimation for interactions:

```{r}
# colliculi location by stimulus type
SCIC_stim_type_interaction_pes <- ANOVA$`Error: subjects:stimulus_type:superior_inferior`[[1]][[2]][1]/(ANOVA$`Error: subjects:stimulus_type:superior_inferior`[[1]][[2]][1] + ANOVA$`Error: subjects:stimulus_type:superior_inferior`[[1]][[2]][2])
cat('colliculi location by stimulus type partial eta squared:', SCIC_stim_type_interaction_pes,'\n')

# laterality by stimulus type
laterality_stim_type_interaction_pes <- ANOVA$`Error: subjects:laterality:stimulus_type`[[1]][[2]][1]/(ANOVA$`Error: subjects:laterality:stimulus_type`[[1]][[2]][1] + ANOVA$`Error: subjects:laterality:stimulus_type`[[1]][[2]][2])
cat('laterality by stimulus type partial eta squared:', laterality_stim_type_interaction_pes,'\n')

# laterality by colliculi location
laterality_SCIC_interaction_pes <- ANOVA$`Error: subjects:laterality:superior_inferior`[[1]][[2]][1]/(ANOVA$`Error: subjects:laterality:superior_inferior`[[1]][[2]][1] + ANOVA$`Error: subjects:laterality:superior_inferior`[[1]][[2]][2])
cat('laterality by colliculi location partial eta squared:', laterality_SCIC_interaction_pes,'\n')

```

Follow-up paired t test for SC vs. IC activation

```{r}
library(dplyr)
fullmaskdata %>%
  filter(superior_inferior=='SC') -> SCbetas
SCbetas <- rowMeans(cbind(SCbetas$betas[1:11],SCbetas$betas[12:22],SCbetas$betas[23:33],SCbetas$betas[34:44]))
fullmaskdata %>%
  filter(superior_inferior=='IC') -> ICbetas
ICbetas <- rowMeans(cbind(ICbetas$betas[1:11],ICbetas$betas[12:22],ICbetas$betas[23:33],ICbetas$betas[34:44]))
t.test(SCbetas, ICbetas, paired = T)
```

Follow-up paired t test for SC activation in aversive vs. neutral conditions

```{r}
SCdata <- filter(fullmaskdata, superior_inferior == 'SC')
SCdata %>%
  filter(stimulus_type == 'Neutral') -> SCneu
SCneubetas <- rowMeans(cbind(SCneu$betas[1:11],SCneu$betas[12:22]))
SCdata %>%
  filter(stimulus_type == 'Aversive') -> SCave
SCavebetas <- rowMeans(cbind(SCave$betas[1:11],SCave$betas[12:22]))
t.test(SCavebetas, SCneubetas, paired = T)
```

Follow-up paired t test for IC activation in aversive vs. neutral conditions

```{r}
fullmaskdata %>%
  filter(superior_inferior == 'IC') -> ICdata
ICdata %>%
  filter(stimulus_type == 'Neutral') -> ICneu
ICneubetas <- rowMeans(cbind(ICneu$betas[1:11],ICneu$betas[12:22]))
ICdata %>%
  filter(stimulus_type == 'Aversive') -> ICave
ICavebetas <- rowMeans(cbind(ICave$betas[1:11],ICave$betas[12:22]))
t.test(ICavebetas, ICneubetas, paired = T)
```

## plots

# SC vs. IC 
```{r}
# SC vs. IC plot with other factors averaged across:
library(dplyr)
library(ggplot2)
fullmaskdata %>%
  group_by(subjects, superior_inferior) %>%
  summarise(mean_beta = mean(betas)) %>%
  ggplot(aes(x = superior_inferior, y = mean_beta))+
  geom_bar(width=0.5, fill='gray',color = 'black',stat = "summary", fun.y = "mean") +
  geom_hline(yintercept = 0) +
  geom_errorbar(width=.1, stat="summary", fun.data="mean_se")+
  scale_colour_grey() +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  labs(y = "beta estimates (arbitrary units)", x = ' ') +
  theme(axis.title.y = element_text(family="Arial", size=12),
       axis.text.x = element_text(family="Arial", size=12, color='black'),
       plot.margin = unit(c(1,5.5,1,5.5),'cm')) +
  scale_x_discrete(labels=c('Inferior Colliculi' = 'IC', 'Superior Colliculi' = 'SC')) 
```

# left vs. right activation in the SC
```{r}
# left vs. right activation in the SC only, averaged across image categories
SCdata %>%
  group_by(subjects, laterality) %>%
  summarise(mean_beta = mean(betas)) %>%
  ggplot(aes(x = laterality, y = mean_beta))+
  geom_bar(width=0.5, fill='gray',color = 'black',stat = "summary", fun.y = "mean") +
  geom_hline(yintercept = 0) +
  geom_errorbar(width=.1, stat="summary", fun.data="mean_se")+
  scale_colour_grey() +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  labs(y = "beta estimates (arbitrary units)", x = ' ') +
  theme(axis.title.y = element_text(family="Arial", size=12),
       axis.text.x = element_text(family="Arial", size=12, color='black'),
       plot.margin = unit(c(1,5.5,1,5.5),'cm')) +
  scale_x_discrete(labels=c('Left' = 'Left SC', 'Right' = 'Right SC'))
```

# Neutral vs. Aversive activation in the SC
```{r}
# Neutral vs. Aversive activation in the SC, averaged across lateral locations
SCdata %>%
  group_by(subjects, stimulus_type) %>%
  summarise(mean_beta = mean(betas)) %>%
  ggplot(aes(x = stimulus_type, y = mean_beta))+
  geom_bar(width=0.5, fill='gray',color = 'black',stat = "summary", fun.y = "mean") +
  geom_hline(yintercept = 0) +
  geom_errorbar(width=.1, stat="summary", fun.data="mean_se")+
  scale_colour_grey() +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  labs(y = "beta estimates (arbitrary units)", x = ' ') +
  theme(axis.title.y = element_text(family="Arial", size=12),
       axis.text.x = element_text(family="Arial", size=12, color='black'),
       plot.margin = unit(c(1,5.5,1,5.5),'cm')) 
```

## Read the data from Matlab script output after controlling for stimuli visual properties

In the script that produced this output, normed stimuli luminance, complexity, and contrast were added into the model as regressors.

```{r}
# SC and IC parameter estimates after adding visual property regressors to the model
visprop <- readMat('Analysis4_fullmaskcolliculi_hd_visprop_output.mat')
leftICneu <- visprop[[1]][,neu_colnum] # parameter estimates for 11 subjects; left IC neutral
leftICaver <- visprop[[1]][,aver_colnum]
leftSCneu <- visprop[[2]][,neu_colnum]
leftSCaver <- visprop[[2]][,aver_colnum]
rightICneu <- visprop[[3]][,neu_colnum]
rightICaver <- visprop[[3]][,aver_colnum]
rightSCneu <- visprop[[4]][,neu_colnum]
rightSCaver <- visprop[[4]][,aver_colnum]
vispropdata <- fullmaskdata # copy the previous dataframe
vispropdata$betas <- c(leftSCneu,leftSCaver,leftICneu,leftICaver,rightSCneu,rightSCaver,rightICneu,rightICaver) # update the betas in the new dataframe
```

## 2 x 2 x 2 ANOVA with superior/inferior colliculi, left/right laterality, and neutral/aversive image using parameter estimates obtained after controlling for stimuli visual properties

```{r}
vispropdata$subjects <- as.factor(vispropdata$subjects)
mod3 <- with(vispropdata, aov(vispropdata$betas ~ laterality * stimulus_type * superior_inferior + Error(subjects / (laterality * stimulus_type * superior_inferior))))
ANOVA <- summary(mod3)
ANOVA
```

Significant main effects of stimulus type and colliculi location. Laterality effect attenuated.
Effect size estimation for main effects:
```{r}
# superior vs. inferior colliculi
superior_inferior_sumsq <- ANOVA$`Error: subjects:superior_inferior`[[1]][[2]][1]
superior_inferior_resid_sumsq <- ANOVA$`Error: subjects:superior_inferior`[[1]][[2]][2]
superior_inferior_pes <- superior_inferior_sumsq/(superior_inferior_sumsq + superior_inferior_resid_sumsq)

# left vs. right colliculi 
laterality_sumsq <- ANOVA$`Error: subjects:laterality`[[1]][[2]][1]
laterality_resid_sumsq <- ANOVA$`Error: subjects:laterality`[[1]][[2]][2]
laterality_pes <- laterality_sumsq/(laterality_sumsq + laterality_resid_sumsq)

# aversive vs. neutral stimuli category
stimulus_type_sumsq <- ANOVA$`Error: subjects:stimulus_type`[[1]][[2]][1]
stimulus_type_resid_sumsq <- ANOVA$`Error: subjects:stimulus_type`[[1]][[2]][2]
stimulus_type_pes <- stimulus_type_sumsq/(stimulus_type_sumsq + stimulus_type_resid_sumsq)

sprintf('Estimated effect size (partial eta squared) is %f for superior vs. inferior colliculi main effect, %f for laterality main effect, %f for stimulus category main effect.', superior_inferior_pes, laterality_pes, stimulus_type_pes)
```
